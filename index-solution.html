<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Framework Lesson 2: Bringing The DOM To Life</title>
  </head>
  <body>
    <div x-data="{count: 0}">
      <button @click="count += 1">+</button>
      <button @click="count -= 1">-</button>
      <span x-text="count"></span>
    </div>

    <script>
      let root = document.querySelector("[x-data]");
      let data = getInitialData(root);

      function getInitialData(element) {
        return eval(`(${element.getAttribute("x-data")})`);
      }

      function execute(expression) {
        return eval(`with(data) {(${expression})}`);
      }

      // Walk the dom and update it
      function refreshDOM() {
        walkDOM(root, (el) => {
          if (el.hasAttribute("x-text")) {
            let expression = el.getAttribute("x-text");

            el.innerText = execute(expression);
          }
        });
      }

      refreshDOM();

      function walkDOM(el, callback) {
        callback(el);

        el = el.firstElementChild;

        while (el) {
          walkDOM(el, callback);

          el = el.nextElementSibling;
        }
      }
    </script>
  </body>
</html>
